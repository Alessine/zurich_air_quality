config {
    type: "table",
    bigquery: {
        partitionBy: "date",
        clusterBy: ["location"]
    }
}

SELECT
  date,
  location,
  location_short_name,
  parameter,
  parameter_name,
  parameter_category,
  unit,
  value,
  AVG(value) OVER(PARTITION BY location, parameter ORDER BY date ROWS BETWEEN 7 PRECEDING AND CURRENT ROW) AS value_7d
FROM
  ${ref("air_quality_staging")}
